{"additions":241,"author":{"is_bot":true,"login":"app/roomote"},"baseRefName":"main","body":"This PR addresses issue #5859 by adding configurable diagnostic delay settings to prevent Go diagnostics errors from being submitted to the LLM before the linter has time to clean up unused imports.\n\n## Changes Made\n\n### Core Features\n- **Added `diagnosticsDelayMs` setting** (default: 2000ms) - allows users to configure how long to wait before checking diagnostics after file saves\n- **Added `diagnosticsEnabled` setting** (default: true) - allows users to completely disable diagnostic checking if desired\n\n### Implementation Details\n- **Updated `DiffViewProvider.saveChanges()`** to accept diagnostic settings and implement configurable delay\n- **Modified all tool files** to pass diagnostic settings from provider state:\n  - `writeToFileTool.ts`\n  - `searchAndReplaceTool.ts` \n  - `insertContentTool.ts`\n  - `applyDiffTool.ts`\n  - `multiApplyDiffTool.ts`\n- **Added message types and handlers** for UI configuration of new settings\n- **Updated global state management** to include new diagnostic settings\n\n### Testing\n- **Added comprehensive test coverage** for the new diagnostic functionality in `DiffViewProvider.spec.ts`\n- Tests cover delay behavior, enable/disable functionality, and default values\n\n## Problem Solved\n\nPreviously, Go diagnostics errors were immediately captured after file saves, before Go tools like `goimports` had time to automatically clean up unused imports. This caused unnecessary token usage and confusion for LLMs when they received error messages about imports that would be automatically removed.\n\nWith this change:\n- **Go developers** can set a 2-3 second delay to allow `goimports` and other tools to process files\n- **Other language users** can adjust the delay or disable diagnostics entirely based on their workflow\n- **Backward compatibility** is maintained with sensible defaults\n\n## Configuration\n\nUsers can configure these settings through the Roo Code UI:\n- `diagnosticsDelayMs`: Milliseconds to wait before checking diagnostics (default: 2000)\n- `diagnosticsEnabled`: Whether to check diagnostics at all (default: true)\n\nResolves #5859\n<!-- ELLIPSIS_HIDDEN -->\n\n\n----\n\n> [!IMPORTANT]\n> Adds configurable delay and enable/disable settings for Go diagnostics to prevent premature error reporting.\n> \n>   - **Behavior**:\n>     - Adds `diagnosticsDelayMs` setting (default: 2000ms) to configure delay before checking diagnostics after file saves.\n>     - Adds `diagnosticsEnabled` setting (default: true) to enable/disable diagnostic checking.\n>   - **Implementation**:\n>     - Updates `DiffViewProvider.saveChanges()` to use new diagnostic settings with delay.\n>     - Modifies `writeToFileTool.ts`, `searchAndReplaceTool.ts`, and `insertContentTool.ts` to pass diagnostic settings.\n>     - Adds message types and handlers in `webviewMessageHandler.ts` for UI configuration.\n>   - **Testing**:\n>     - Adds tests in `DiffViewProvider.spec.ts` for delay behavior and enable/disable functionality.\n> \n> <sup>This description was created by </sup>[<img alt=\"Ellipsis\" src=\"https://img.shields.io/badge/Ellipsis-blue?color=175173\">](https://www.ellipsis.dev?ref=RooCodeInc%2FRoo-Code&utm_source=github&utm_medium=referral)<sup> for 1e76168a66964674c42d37570695f00ce42d56c0. You can [customize](https://app.ellipsis.dev/RooCodeInc/settings/summaries) this summary. It will automatically update as commits are pushed.</sup>\n\n\n<!-- ELLIPSIS_HIDDEN -->","changedFiles":16,"deletions":31,"files":[{"path":"packages/types/src/global-settings.ts","additions":5,"deletions":1},{"path":"src/core/tools/__tests__/insertContentTool.spec.ts","additions":8,"deletions":0},{"path":"src/core/tools/__tests__/writeToFileTool.spec.ts","additions":9,"deletions":1},{"path":"src/core/tools/applyDiffTool.ts","additions":6,"deletions":1},{"path":"src/core/tools/insertContentTool.ts","additions":6,"deletions":1},{"path":"src/core/tools/multiApplyDiffTool.ts","additions":6,"deletions":1},{"path":"src/core/tools/searchAndReplaceTool.ts","additions":6,"deletions":1},{"path":"src/core/tools/writeToFileTool.ts","additions":6,"deletions":1},{"path":"src/core/webview/ClineProvider.ts","additions":6,"deletions":2},{"path":"src/core/webview/__tests__/ClineProvider.spec.ts","additions":48,"deletions":9},{"path":"src/core/webview/webviewMessageHandler.ts","additions":4,"deletions":0},{"path":"src/integrations/editor/DiffViewProvider.ts","additions":32,"deletions":13},{"path":"src/integrations/editor/__tests__/DiffViewProvider.spec.ts","additions":91,"deletions":0},{"path":"src/shared/ExtensionMessage.ts","additions":1,"deletions":0},{"path":"src/shared/WebviewMessage.ts","additions":1,"deletions":0},{"path":"src/shared/constants.ts","additions":6,"deletions":0}],"headRefName":"feature/configurable-diagnostics-delay","number":5863,"state":"OPEN","title":"feat: add configurable delay for Go diagnostics to prevent premature error reporting","url":"https://github.com/RooCodeInc/Roo-Code/pull/5863"}